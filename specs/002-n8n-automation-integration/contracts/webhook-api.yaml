openapi: 3.0.3
info:
  title: n8n Webhook API
  description: Webhook-Endpoints für n8n Automation Integration
  version: 1.0.0
  contact:
    name: WA LinkedIn Manager
    email: support@example.com

servers:
  - url: http://localhost:3000/api
    description: Development Server
  - url: https://api.example.com/api
    description: Production Server

paths:
  /webhooks/company-research:
    post:
      summary: Trigger Company Research Workflow
      description: Startet n8n Workflow für AI-gestützte Company Research mit Perplexity API
      operationId: triggerCompanyResearch
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyResearchRequest'
            example:
              companyId: "65a1b2c3d4e5f6g7h8i9j0k1"
      responses:
        '200':
          description: Workflow erfolgreich gestartet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyResearchResponse'
              example:
                success: true
                companyId: "65a1b2c3d4e5f6g7h8i9j0k1"
                message: "Company research workflow started"
        '400':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Invalid companyId"
                code: "VALIDATION_ERROR"
        '404':
          description: Company not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Company not found"
                code: "NOT_FOUND"
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /webhooks/scrape-reference-post:
    post:
      summary: Trigger Reference Post Scraping Workflow
      description: Startet n8n Workflow für LinkedIn Post Scraping
      operationId: triggerReferencePostScraping
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReferencePostScrapingRequest'
            example:
              companyId: "65a1b2c3d4e5f6g7h8i9j0k1"
              linkedinUrl: "https://www.linkedin.com/posts/username_activity-1234567890"
      responses:
        '200':
          description: Workflow erfolgreich gestartet oder Duplikat erkannt
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReferencePostScrapingResponse'
              example:
                success: true
                referencePostId: "65a2b3c4d5e6f7g8h9i0j1k2l3"
                duplicate: false
                message: "Reference post scraping workflow started"
        '400':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Company not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /webhooks/generate-content:
    post:
      summary: Trigger Content Generation Workflow
      description: Startet n8n Workflow für AI Content Generation mit OpenAI GPT-4
      operationId: triggerContentGeneration
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContentGenerationRequest'
            example:
              generatedPostId: "65a3b4c5d6e7f8g9h0i1j2k3l4"
              generateImage: true
      responses:
        '200':
          description: Workflow erfolgreich gestartet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentGenerationResponse'
              example:
                success: true
                generatedPostId: "65a3b4c5d6e7f8g9h0i1j2k3l4"
                message: "Content generation workflow started"
        '400':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Generated Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    CompanyResearchRequest:
      type: object
      required:
        - companyId
      properties:
        companyId:
          type: string
          description: Payload CMS Company ID
          example: "65a1b2c3d4e5f6g7h8i9j0k1"
      additionalProperties: false

    CompanyResearchResponse:
      type: object
      required:
        - success
        - companyId
      properties:
        success:
          type: boolean
          example: true
        companyId:
          type: string
          example: "65a1b2c3d4e5f6g7h8i9j0k1"
        message:
          type: string
          example: "Company research workflow started"

    ReferencePostScrapingRequest:
      type: object
      required:
        - companyId
        - linkedinUrl
      properties:
        companyId:
          type: string
          description: Payload CMS Company ID
          example: "65a1b2c3d4e5f6g7h8i9j0k1"
        linkedinUrl:
          type: string
          format: uri
          description: LinkedIn Post URL
          example: "https://www.linkedin.com/posts/username_activity-1234567890"
      additionalProperties: false

    ReferencePostScrapingResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true
        referencePostId:
          type: string
          description: Created/Existing Reference Post ID
          example: "65a2b3c4d5e6f7g8h9i0j1k2l3"
        duplicate:
          type: boolean
          description: true if post already exists
          example: false
        message:
          type: string
          example: "Reference post scraping workflow started"

    ContentGenerationRequest:
      type: object
      required:
        - generatedPostId
      properties:
        generatedPostId:
          type: string
          description: Payload CMS Generated Post ID
          example: "65a3b4c5d6e7f8g9h0i1j2k3l4"
        generateImage:
          type: boolean
          description: Whether to generate AI image with DALL-E
          default: false
          example: true
      additionalProperties: false

    ContentGenerationResponse:
      type: object
      required:
        - success
        - generatedPostId
      properties:
        success:
          type: boolean
          example: true
        generatedPostId:
          type: string
          example: "65a3b4c5d6e7f8g9h0i1j2k3l4"
        message:
          type: string
          example: "Content generation workflow started"

    ErrorResponse:
      type: object
      required:
        - success
        - error
        - code
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Validation error message"
        code:
          type: string
          enum:
            - VALIDATION_ERROR
            - NOT_FOUND
            - API_ERROR
          example: "VALIDATION_ERROR"
        details:
          type: object
          description: Additional error details
          additionalProperties: true

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer Token für Payload CMS API Authentication

security:
  - BearerAuth: []

